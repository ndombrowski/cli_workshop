{
  "hash": "a6aa59037181c5deb817503b452d4a21",
  "result": {
    "engine": "knitr",
    "markdown": "---\ncode-block-bg: true\ncode-block-border-left: \"#31BAE9\"\nexecute:\n  eval: false\nengine: knitr\nbibliography: references.bib\n---\n\n\n\n<div style=\"text-align: justify\">\n\n# Introduction to an HPC\n\nNow, that we are familiar with using the cli, let's upload our sequencing data to an HPC an run some software to check the quality of our reads.\n\n## Connecting to a sever\n\n**SSH** (Secure Shell) is a network protocol that enables secure remote connections between two systems. The basic command to login looks like this:\n\n\n\n::: {.cell}\n\n```{.bash .cell-code}\n#connect to a server\nssh -X username@server\n```\n:::\n\n\n\nOptions:\n\n-   `-X` option enables untrusted X11 forwarding in SSH. Untrusted means = your local client sends a command to the remote machine and receives the graphical output. We use it since it enables users to run graphical applications on a remote server \n\nIf you have access to and want to connect to crunchomics you would connect like this:\n\n\n\n::: {.cell}\n\n```{.bash .cell-code}\nssh -X uvanetid1@omics-h0.science.uva.nl\n```\n:::\n\n\n\n::: callout-important\nIf you want to log into Crunchomics from outside of UvA you need to be connected to the VPN. \nIf you have not set that up and/or have trouble doing so, contact ICT.\n:::\n\n\n## Crunchomics: Preparing your account\n\nIf you have not used Crunchomics before, then you want to run a small Bash script that:\n\n- Allows you to use system-wide installed software, by adding `/zfs/omics/software/bin` to your path. This basically means that bash knows that there is an extra folder in which to look for any software that is already installed\n- Sets up a python3 environment and some usefull python packages\n- Have a link for your 500 GB personal directory in your home directory \n\nTo set this up, run the following in the cli:\n\n\n\n::: {.cell}\n\n```{.bash .cell-code}\n/zfs/omics/software/script/omics_install_script\n```\n:::\n\n\n\n\n## `scp`: Transferring data from/to a server\n\n`scp` stands for Secure Copy Protocol and allows us to securely copy files and directories between remote hosts. When transferring data the transfer is prepared from the terminal of your local computer and not from the HPCs login node.\n\nThe basic syntax is:\n\n`scp [options] SOURCE DESTINATION`\n\nTo start analysing our data, we want to move our fastq.gz files from our local folder, the source, to a folder on Cruncomics, the destination. Let's start by:\n\n- Moving from our home directory into our personal directory. We move there since we have more space in the personal directory. Notice, for bash to find the personal directory, we need to have run the `omics_install_script` script above first\n- Make a project folder with a descriptive file name\n\n\n\n::: {.cell}\n\n```{.bash .cell-code}\ncd personal/\nmkdir projectX\ncd projectX\n\n```\n:::\n\n\n\nInto our project directory, we the want to move the data we have before downloaded with our sequencing data. We do this by moving the `data` folder we generated before from our local computer to the HPC. Therefore, it is important that:\n\n- we run the following command from the cli on our own computer and not from the cli while being logged into the HPC! \n- you exchange the two instances of `username` in the code below with your username\n  \nI am running the code from the `data_analysis` folder that we have generated in the previous tutorial  and I use the `-r` option since we are moving a folder, not a file.\n\n\n\n::: {.cell}\n\n```{.bash .cell-code}\nscp -r data username@omics-h0.science.uva.nl:/home/username/personal/projectX\n\n#check if that worked \nll data/seq_project/*/*fastq.gz\n```\n:::\n\n\n\n::: {.callout-tip title=\"Tip: moving data from the HPC to our own computer\" collapse=\"true\"}\n\nWe can also move data from the HPC to our own computer. For example, let's assume we want to move a single sequencing file. In this case, \n\n- We do not need `-r` since we only move a single file.\n- We again run this command from a terminal on our computer, not while being logged in the HPC\n- We use `.` to indicate that we want to move the file into the directory we are currently in. If we want to move the file elsewhere we can use any absolute or relative path as needed\n\n\n\n::: {.cell}\n\n```{.bash .cell-code}\nscp username@omics-h0.science.uva.nl:/home/username/personal/projectX/data/seq_project/barcode001_User1_ITS_1_L001/Sample-DUMMY1_R1.fastq.gz .\n```\n:::\n\n\n\n:::\n\n\n::: {.callout-tip title=\"Tip: moving data from the HPC using wildcards\" collapse=\"true\"}\n\nWe can also move several files at once and ignore the whole folder structure by using wildcards when using `scp`.\n\n\n\n::: {.cell}\n\n```{.bash .cell-code}\n#make a random directory to move our data into for testing purposes\nmkdir transfer_test\n\nscp data/seq_project/barcode00*/*fastq.gz username@omics-h0.science.uva.nl:/home/username/personal/projectX/transfer_test\n\n#view the data, see how the folder structure is different compared to our first example? \nll transfer_test/*\n```\n:::\n\n\n\n**Notice for MAC users**:\n\nFor Mac users that work with an zsh shell this might not work and they might get an error like \"file not found\", \"no matches found\" or something the like.\nWithout going into details zsh has a slightly different way of handling wildcards and tries to interpret the wildcard literally and tries not to extend the wildcard.\nIf you see the error and you are sure the file exists it should work to edit your line of code as follows:\n\n\n\n::: {.cell}\n\n```{.bash .cell-code}\n\\scp  data/seq_project/barcode00*/*fastq.gz username@omics-h0.science.uva.nl:/home/username/personal/projectX/transfer_test\n```\n:::\n\n\n\nIf that does not work, these are some other things to try (different zsh environments might need slightly different solutions):\n\n\n\n::: {.cell}\n\n```{.bash .cell-code}\nnoglob scp  data/seq_project/barcode00*/*fastq.gz ndombro@omics-h0.science.uva.nl:/home/ndombro/personal/projectX/transfer_test\n\nscp  'data/seq_project/barcode00*/*fastq.gz' ndombro@omics-h0.science.uva.nl:/home/ndombro/personal/projectX/transfer_test\n```\n:::\n\n\n\n:::",
    "supporting": [
      "hpc_howto_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}